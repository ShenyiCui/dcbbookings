<!doctype html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Settings</title>
	<!--my own external stylesheets and JS-->
	<link href="../CSS/main.css" rel="stylesheet">
	<script src="../JS/main.js"></script>
	<script src="../JS/GlobalStaticVars.js"></script>
	<!--Imported Stylesheets and JS-->
	<script src="../JS/aws-cognito.js"></script>
	<script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.4.0.min.js"></script>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	<link rel="stylesheet" href="../CSS/bootstrap.css">
	<script src="../JS/NicEdit.js" type="text/javascript"></script><!--TextEdit-->
	<script type="text/javascript">bkLib.onDomLoaded(nicEditors.allTextAreas);</script>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.css">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.js"></script>
	<script src="../JS/nprogress.js"></script>
	<link rel="stylesheet" href="../CSS/nprogress.css">
	<script src="../JS/Jquery UI/jquery-ui.min.js"></script>
	<link rel="stylesheet" href="../JS/Jquery UI/jquery-ui.min.css">
</head>

<body>

	<!--Loader showing up when the site is loading in-->
	<div id="Loader" class="loader">
		<img width="12.5%" src="../Images/loader.gif">
		<br><br><br><br><br><br><br>
		<p id="loaderTxt"></p>
	</div>

	<div id="settingSideNav">

		<div id="backToMainPage">
			<i onClick="self.location='Make_Booking.html'" class="fa fa-arrow-left imgBtn" aria-hidden="true"></i>
			<p onClick="self.location='Make_Booking.html'" class="imgBtn" style="display: inline-block; margin: 0;">Go Back</p>
			<p class="closebtn" id="closeSideNavSettings" onclick="closeSettingsNav()">&times;</p>
		</div>

		<br><br>

		<div onClick="currentSettingsSlide(1);changeSettingTitle('Account Details');" class="settingsPageBtn imgBtn edit_hover_class">
			<p><i class="fa fa-address-card-o" aria-hidden="true"></i>&nbsp;&nbsp;&nbsp;Account Details</p>
			<p align="right"><a><i class="fa fa-sign-in" aria-hidden="true"></i></a></p>
		</div>
		<div onClick="getMyResos();currentSettingsSlide(2);changeSettingTitle('My Resource Settings');" class="settingsPageBtn imgBtn edit_hover_class">
			<p><i class="fa fa-database" aria-hidden="true"></i>&nbsp;&nbsp;&nbsp;My Resource Settings</p>
			<p align="right"><a><i class="fa fa-sign-in" aria-hidden="true"></i></a></p>
		</div>
		<br><br>
		<div onClick="currentSettingsSlide(3);changeSettingTitle('History');" class="settingsPageBtn imgBtn edit_hover_class">
			<p><i class="fa fa-history" aria-hidden="true"></i>&nbsp;&nbsp;&nbsp;History</p>
			<p align="right"><a><i class="fa fa-sign-in" aria-hidden="true"></i></a></p>
		</div>
		<div onClick="currentSettingsSlide(4);changeSettingTitle('My Data');" class="settingsPageBtn imgBtn edit_hover_class">
			<p><i class="fa fa-info-circle" aria-hidden="true"></i>&nbsp;&nbsp;&nbsp;My Data</p>
			<p align="right"><a><i class="fa fa-sign-in" aria-hidden="true"></i></a></p>
		</div>
		<div onClick="currentSettingsSlide(5);changeSettingTitle('My Resource Data');" class="settingsPageBtn imgBtn edit_hover_class">
			<p><i class="fa fa-info-circle" aria-hidden="true"></i>&nbsp;&nbsp;&nbsp;My Resource Data</p>
			<p align="right"><a><i class="fa fa-sign-in" aria-hidden="true"></i></a></p>
		</div>
		<br><br>

		<div id="adminSettings">
			<div onClick="generateMilestoneTable(); currentSettingsSlide(6); changeSettingTitle('Change Current Week &nbsp;<i onClick=\'showHelpMessageCW()\' class=\'fa fa-question-circle imgBtn\' aria-hidden=\'true\'></i>');" class="settingsPageBtn imgBtn edit_hover_class">
				<p><i class="fa fa-sliders" aria-hidden="true"></i>&nbsp;&nbsp;&nbsp;Change Current Week</p>
				<p align="right"><a><i class="fa fa-sign-in" aria-hidden="true"></i></a></p>
			</div>
			<br><br>
			<div onClick="currentSettingsSlide(7);generateAdminTable();changeSettingTitle('Admin Users');" class="settingsPageBtn imgBtn edit_hover_class">
				<p><i class="fa fa-user-md" aria-hidden="true"></i>&nbsp;&nbsp;&nbsp;Admin Users</p>
				<p align="right"><a><i class="fa fa-sign-in" aria-hidden="true"></i></a></p>
			</div>
			<div onClick="currentSettingsSlide(8);changeSettingTitle('Teachers');" class="settingsPageBtn imgBtn edit_hover_class">
				<p><i class="fa fa-user-circle-o" aria-hidden="true"></i>&nbsp;&nbsp;&nbsp;Teachers</p>
				<p align="right"><a><i class="fa fa-sign-in" aria-hidden="true"></i></a></p>
			</div>
			<div onClick="currentSettingsSlide(9);changeSettingTitle('Students');" class="settingsPageBtn imgBtn edit_hover_class">
				<p><i class="fa fa-users" aria-hidden="true"></i>&nbsp;&nbsp;&nbsp;Students</p>
				<p align="right"><a><i class="fa fa-sign-in" aria-hidden="true"></i></a></p>
			</div>
			<div onClick="currentSettingsSlide(10);changeSettingTitle('Users Pending Approval');" class="settingsPageBtn imgBtn edit_hover_class">
				<p><i class="fa fa-user-o" aria-hidden="true"></i>&nbsp;&nbsp;&nbsp;Users Pending Approval</p>
				<p align="right"><a><i class="fa fa-sign-in" aria-hidden="true"></i></a></p>
			</div>
			<br><br>
			<div onClick="currentSettingsSlide(11);changeSettingTitle('User Data Analysis');" class="settingsPageBtn imgBtn edit_hover_class">
				<p><i class="fa fa-table" aria-hidden="true"></i>&nbsp;&nbsp;&nbsp;User Data Analysis</p>
				<p align="right"><a><i class="fa fa-sign-in" aria-hidden="true"></i></a></p>
			</div>
			<div onClick="currentSettingsSlide(12);changeSettingTitle('Resource Data Analysis');" class="settingsPageBtn imgBtn edit_hover_class">
				<p><i class="fa fa-table" aria-hidden="true"></i>&nbsp;&nbsp;&nbsp;Resource Data Analysis</p>
				<p align="right"><a><i class="fa fa-sign-in" aria-hidden="true"></i></a></p>
			</div>
		</div>
	</div>

	<div id="mainSettingsPanel">
		<div id="settingsTitleCard">
			<div style="margin-top: 5px;" id="HiddenMenuBtn"><i onClick="openSettingsNav();" class="fa fa-bars imgBtn"></i></div>
			<p align="center" id="SettingsTitleP">Account Details</p>
			<label align = "right"></label>
		</div>

		<!--Account Details 1-->
		<div class="SettingsSlide"></div>
		<!--My Resources 2-->
		<div class="SettingsSlide">
			<center>
				<input type="text" id="searchResosInput" onkeyup="searchMyResos()" placeholder="Search Resources..."><br><br>
				<ul id="myResosList"></ul>
			</center>
		</div>

		<!--History 3-->
		<div class="SettingsSlide"></div>
		<!--My Data 4-->
		<div class="SettingsSlide"></div>
		<!--My Resource Data 5-->
		<div class="SettingsSlide"></div>

		<!--Change Current Week 6-->
		<div class="SettingsSlide">
			<div id="addAMilestone">
				<br>
				<p style="font-size:18px;" align="center">Add a Milestone</p>
				<br>
				<center>
					<p id="milestoneErrMsg"></p>
					<div class="sameLine">
						<label>Pick a Date:
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
						</label><br>
						<input id="pickADate" onchange="WeekBeginMilestone();" class="datepicker smallInput">
						&nbsp;&nbsp;&nbsp;
					</div>

					<div class="sameLine">
						<label>Week Begining:
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
						&nbsp;&nbsp;&nbsp;&nbsp;
						</label><br>
						<input id="WBChosen" class="smallInput" disabled>
						&nbsp;&nbsp;&nbsp;
					</div>

					<div class="sameLine">
						<label>It's a week:
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
						</label><br>
						<input id="WBWeekNum" class="smallInput" min="1" max="2" type="number">
						&nbsp;&nbsp;&nbsp;
					</div>
					<br>
					<button class="btnSuccessOutline" id="createMilestoneBtn">Create Milestone</button>
					<br><br>
				</center>
			</div>
			<br>
			<div id="currentMilestones">
				<p style="font-size:18px;" align="center">Current Milestones</p>
				<br>
				<p align="center" id="currentWeekTxt">Currently it is a week: #
				&nbsp;&nbsp;&nbsp;&nbsp;
				<a href="#">Alternate Now</a>
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</p>
				<br><br>
				<center>
					<div id="currentMSTable"><em>[Processing Data...]</em></div>
				</center>
				<br><br>
			</div>
		</div>
		<!--Admin Users 7-->
		<div class="SettingsSlide">
			<center>
				<input type="text" placeholder="Email" id="emailInput">
				<br>
				<button class="btnSuccessOutline" id="addUserBtn">Add User</button>
				<br><br><br>
				<div id="AdminUserTable"></div>
			</center>
		</div>
		<!--Teachers 8-->
		<div class="SettingsSlide"></div>
		<!--Students 9-->
		<div class="SettingsSlide"></div>
		<!--Users Pending Approval 10-->
		<div class="SettingsSlide"></div>

		<!--User Data Analysis 11-->
		<div class="SettingsSlide"></div>
		<!--Resource Data Analysis 12-->
		<div class="SettingsSlide"></div>

	</div>

	<div id="resosSettingsModal" class="Modal">
		<!--resosSettingsModal Modal content -->
		<div class="resosSettingsModal-content">
			<span id="resosSettingsModalCloseBtn" class="Modalclose">&times;</span>
			<h3 id="settingsTitle" align="center">Technology 1: Room Settings</h3>

			<div id="viewResosInfo">
				<label>Resource ID (non-editable):</label>
				<input type="text" id="resosIDval" readonly disabled>

				<label>Department</label>
				<input type="text" id="departmentVal">

				<label>Description</label>
				<textarea id="DescriptionVal"></textarea>

				<br>
				<select id="accessRightSelect" class="select100">
					<option value="invalid">Access Rights:</option>
					<option value="Student">Make room available to Students ONLY</option>
					<option value="Teacher">Make room available to Teachers ONLY</option>
					<option value="TeacherStudent">Make room available to both Teachers and Students</option>
				</select>
				<br><br>

				<label>Room Admin (non-editable):</label>
				<input type="text" id="RoomAdmin1" name="Admin1" readonly disabled>

				<label>Other Admins <em>[ Separate room admins emails with a ' ; ' ]  OPTIONAL </em></label>
				<input type="text" id="RoomAdmin2" placeholder="Other Admins [ Enter Emails ]:" name="Admin2">
				<br>
				<input type="checkbox" id="planAheadCB">
				<label>&nbsp;Plan Ahead [Close booking ability 30 minutes ahead of time]</label>
				<br>
				<input type="checkbox" id="30MinPeriodCB">
				<label>&nbsp;30 minute period [Split each period into 30 minute sections]</label>

				<br><br><br>
				<strong><label>Upload New Schedule:</label></strong>
				<center>
					<!--The upload options-->
					<div id="Options">
						<strong><label>Choose a upload source:</label></strong>
						<label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
						<strong><label>Choose a upload method:</label></strong>
						<br>

						<select onChange="checkAvailableUpload()" id="uploadSource">
							<option selected value="invalid">UPLOAD SOURCE...</option>
							<option value="sims">SIMS</option>
							<option value="custom">CUSTOM</option>
						</select>

						<label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>

						<select onChange="checkAvailableUpload()" id="uploadMethods">
							<option selected value="invalid">UPLOAD METHOD...</option>
							<option disabled value="merge">MERGE</option>
							<option value="override">OVERRIDE</option>
						</select>

						<label>&nbsp;&nbsp;&nbsp;&nbsp;</label>
					</div>
					<!--If Cutom upload is chosen the doc will show-->
					<div id="customUploadDocs">
						<br><br>
						<a href="../Documents/SE21_Upload_Template.zip" target="_blank">Download Template</a>
						<label>&nbsp;||&nbsp;</label>
						<a href="../Documents/SE21_README_UserDoc.pdf" target="_blank">Read User Documentation</a>
						<label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
					</div>
					<!--If SIm upload is chosen the doc will show-->
					<div id="SimUploadDocs">
						<br><br>
						<em><label>[Save SIMS file as .CSV with UTF-8] &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label></em>
					</div>
				</center>
				<br><br>
				<form id="fileLoadForm">
					<input id="fileToLoad" type="file" accept=".csv" onChange="">
				</form>


					<div id="PreviewTable">
						<br><br><br>
						<em><p align="center">[Preview Table]</p></em>
					</div>


				<div id="resosSettingsDangerZone">
					<h3>Danger Zone</h3>
					<button id="deleteResos" class="btnDangerOutline" style="border-radius:5px;">Delete This Resource</button>
				</div>

				<button class="createResosBtn" id="saveResosChanges" onClick="resosSaveChanges();">Save Changes</button>
				<label id="resosSettingsErrMsg"></label>
			</div>

			<div id="resosSettingsLoader">
				<br><br><br><br><br><br><br><br><br><br><br><br>
				<center>
					<img width="10%" src="../Images/loader.gif">
				</center>
			</div>
		</div>
	</div>

</body>

<script>//initilizers
	FunnyloadingTxt("loaderTxt",true,2000);
	$( function()//initializing datepicker
	{
    	$(".datepicker").datepicker({
			dateFormat: 'D, dd M yy'
		});
  	});
	
	//autoscalers to make sure that the panel widths match
	if ($(window).width() < 1280 && $(window).width() >= 1150)
	{
		openSettingsNav()
	}
	else if($(window).width() >= 1280)
	{
		openSettingsNav()
	}
	else if($(window).width() <= 1150)
	{
		closeSettingsNav()
	}
	$(window).resize(function()
	{
		if ($(window).width() < 1280 && $(window).width() >= 1150)
		{
			openSettingsNav()
		}
		else if($(window).width() >= 1280)
		{
			openSettingsNav()
		}
		else if($(window).width() <= 1150)
		{
			closeSettingsNav()
		}
	});

	NProgress.configure({ showSpinner: false });
	NProgress.start();
	getUserEmail();
	validateEmail();
	function validateEmail()//get the email of the user
	{
		if(userEmail!=null)
		{
			getAllAdmins()
			validateAdminFetch()
			NProgress.inc();
		}
		else
		{
			window.setTimeout(validateEmail,1000);
		}
	}
	function validateAdminFetch()//get all admin users
	{
		if(allMasterAdmins.length!=0)
		{
			checkIfResosExists()
			validateCheckIfExistandDelete();
			NProgress.inc();
		}
		else
		{
			window.setTimeout(validateAdminFetch,1000);
		}
	}
	function validateCheckIfExistandDelete()//makes sure the current user info is the most up to dataEmail
	{
		if(resosExistCheckAndDeleteComplete == true)
		{
			NProgress.inc();
			checkIfAdmin()
			$("#Loader").fadeOut();
		}
		else
		{
			window.setTimeout(validateCheckIfExistandDelete,1000);
		}
	}
	function checkIfAdmin()//see if you are an admin
	{
		NProgress.done();
		openedSettingsCheckPrelim();
		for(var i = 0; i<allMasterAdmins.length; i++)
		{
			if(userEmail.trim().toLowerCase()==allMasterAdmins[i].trim().toLowerCase())
			{
				masterAdmin= true;
			}
		}
		if(masterAdmin)
		{
			$("#adminSettings").show();
		}
		else
		{
			$("#adminSettings").hide();
		}
	}
</script>
<script>//Resos Settings SLide Code
	var settingsSlideIndex = 1;
	showSettingsSlides(settingsSlideIndex);
	// Next/previous controls
	function plusSettingsSlides(n)
	{
		showSettingsSlides(settingsSlideIndex += n);
	}

	// Thumbnail image controls
	function currentSettingsSlide(n)
	{
		showSettingsSlides(settingsSlideIndex = n);
	}

	function showSettingsSlides(n)
	{
		var i;
		var settingsSlides = document.getElementsByClassName("SettingsSlide");
		if (n > settingsSlides.length) {settingsSlideIndex = 1}
		if (n < 1) {settingsSlideIndex = settingsSlides.length}
		for (i = 0; i < settingsSlides.length; i++) {
			settingsSlides[i].style.display = "none";
		}
		settingsSlides[settingsSlideIndex-1].style.display = "block";
	}

</script>
<script>//resos settings modal code
	var resosSettingsModal = document.getElementById("resosSettingsModal");

	// Get the <span> element that closes the modal
	var closeresosSettingsBtn = document.getElementById("resosSettingsModalCloseBtn");

	// When the user clicks the button, open the modal
	function openResosSettingsModal()
	{
		resosSettingsModal.style.display = "block";
	}
	function closeResosSettingsModal()
	{
		resosSettingsModal.style.display = "none";
	}

	// When the user clicks on <span> (x), close the modal
	closeresosSettingsBtn.onclick = function()
	{
		resosSettingsModal.style.display = "none";
	}
	// When the user clicks anywhere outside of the modal, close it
	window.onclick = function(event)
	{
		if (event.target == resosSettingsModal)
		{
			resosSettingsModal.style.display = "none";
		}
	}
</script>
<script>
	function showHelpMessageCW()//will show a help modal containing information on the Change Week Settings
	{
		$.alert
		({
			theme: 'modern',
			boxWidth: '700px',
    		useBootstrap: false,
			icon: 'fa fa-question-circle',
			title: "<strong><p class=\"indent\">How it works:</p></strong>",
			content: "<p class=\"indent\">The school operates on a bi-weekly system where the timetable changes every week, returning back to its original state every alternate week."+
			"Hence, you see \"Week 1\" and \"Week 2\" in the timetable modal, indicating the current week's timetable its currently showing."+
			"<br><br> The problem however, is that due to the schedule of holidays the schedule of weeks are not always alternating. "+
			"Use this panel to set <em>milestones</em> which are dates where the week will automatically change to a different week, resetting the alternation cycle. "+
			"<br><br>Alternatively you can also simply click the button to change the current week you are on now, also resetting the alternation cycle.</p>",
		});
	}
</script>
</html>
